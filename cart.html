<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyBusiness Cart - Review & Manage</title>
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Custom CSS (if any) -->
    <link rel="stylesheet" href="style.css" />
    <!-- Inline CSS for Cart Page -->
    <style>
      /* Global styles */
      body {
        font-family: 'Roboto', sans-serif;
        background-color: #f8f9fa;
        color: #333;
      }
      main {
        margin-top: 80px; /* To account for fixed header */
        margin-bottom: 80px; /* To account for fixed footer if any */
      }
      /* Small Hero Section */
      .cart-hero {
        background: #007bff; /* A vibrant blue */
        color: #fff;
        padding: 20px 0;
        text-align: center;
      }
      .cart-hero h1 {
        font-size: 1.75rem;
        margin-bottom: 5px;
      }
      .cart-hero p {
        font-size: 1rem;
        margin: 0;
      }
      /* Subheader below hero for extra options */
      .cart-subheader {
        background: #fff;
        border-bottom: 1px solid #dee2e6;
        padding: 10px 0;
      }
      .cart-subheader .container {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .cart-subheader .sub-title {
        font-size: 1.25rem;
        color: #007bff;
        font-weight: bold;
      }
      .cart-subheader .options a {
        margin-left: 15px;
        color: #333;
        font-size: 1.25rem;
      }
      .cart-subheader .options a:hover {
        color: #007bff;
      }
      /* Cart Table Styles */
      .cart-container {
        padding: 30px 0;
      }
      .cart-table {
        width: 100%;
        table-layout: fixed;
      }
      .cart-table th,
      .cart-table td {
        vertical-align: middle;
        text-align: center;
        padding: 8px;
        font-size: 0.9rem;
      }
      .cart-table th {
        background: #f1f1f1;
      }
      .cart-table img {
        max-width: 60px;
        border-radius: 5px;
      }
      /* First column for checkboxes */
      .cart-table .chk-col {
        width: 5%;
      }
      /* Product name styling (wrap text nicely) */
      .cart-table .prod-name {
        word-wrap: break-word;
      }
      /* Quantity controls */
      .quantity-controls {
        display: inline-flex;
        align-items: center;
      }
      .quantity-controls button {
        border: none;
        padding: 4px 8px;
        font-size: 0.8rem;
        cursor: pointer;
      }
      .quantity-controls .qty-plus {
        background-color: #28a745;
        color: #fff;
      }
      .quantity-controls .qty-minus {
        background-color: #dc3545;
        color: #fff;
      }
      .quantity-controls .quantity-input {
        width: 40px;
        text-align: center;
        border: 1px solid #ced4da;
        margin: 0 4px;
        border-radius: 3px;
        padding: 2px;
      }
      /* When quantity equals zero, display in red */
      .quantity-zero {
        color: red;
        font-weight: bold;
      }
      /* Global delete icon – hidden by default */
      .delete-selected {
        display: none;
        position: fixed;
        top: 90px;
        right: 30px;
        font-size: 1.5rem;
        color: #dc3545;
        cursor: pointer;
        z-index: 1100;
      }
      /* Order Summary Section */
      .order-summary {
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        margin-top: 20px;
      }
      .order-summary h4 {
        font-size: 1.5rem;
        margin-bottom: 20px;
        color: #007bff;
        font-weight: bold;
      }
      .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .summary-total {
        font-size: 1.25rem;
        font-weight: bold;
      }
      .coupon-code {
        margin-top: 20px;
      }
      .coupon-code input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 5px;
      }
      .apply-coupon {
        margin-top: 10px;
      }
      .checkout-btn {
        width: 100%;
        padding: 15px;
        font-size: 1.2rem;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <!-- Header Placeholder (loaded dynamically via loadHTML) -->
    <div id="header-placeholder"></div>
    
    <!-- Global Delete Icon (appears when checkboxes are selected) -->
    <div id="deleteIcon" class="delete-selected" title="Delete Selected Items">
      <i class="fas fa-trash"></i>
    </div>
    
    <!-- Main Content -->
    <main>
      <!-- Small Hero Section -->
      <section class="cart-hero">
        <div class="container">
          <h1>Review & Manage Your Cart</h1>
          <p>Make adjustments before checkout</p>
        </div>
      </section>
      
      <!-- Subheader with extra options -->
      <section class="cart-subheader">
        <div class="container">
          <div class="sub-title">Cart Options</div>
          <div class="options">
            <a href="#" title="Chat with Seller"><i class="fas fa-comments"></i></a>
            <a href="#" title="Track Order"><i class="fas fa-truck"></i></a>
            <a href="#" title="Help & Support"><i class="fas fa-headset"></i></a>
          </div>
        </div>
      </section>
      
      <!-- Cart Table Section -->
      <section class="cart-items">
        <div class="container cart-container">
          <table class="table table-bordered cart-table">
            <thead class="table-light">
              <tr>
                <th class="chk-col"><input type="checkbox" id="selectAll" onchange="toggleSelectAll(this)"></th>
                <th style="width: 15%;">Image</th>
                <th style="width: 35%;">Product</th>
                <th style="width: 15%;">Price (PKR)</th>
                <th style="width: 20%;">Quantity</th>
                <th style="width: 15%;">Subtotal (PKR)</th>
              </tr>
            </thead>
            <tbody id="cartItemsContainer">
              <!-- Cart items will be dynamically rendered here -->
            </tbody>
          </table>
        </div>
      </section>
      
      <!-- Order Summary Section -->
      <section class="order-summary-section">
        <div class="container">
          <div class="row">
            <div class="col-lg-4 offset-lg-8">
              <div class="order-summary">
                <h4>Order Summary</h4>
                <div class="summary-item">
                  <span>Subtotal:</span>
                  <span id="subtotalDisplay">0.00</span>
                </div>
                <div class="summary-item">
                  <span>Tax (10%):</span>
                  <span id="taxDisplay">0.00</span>
                </div>
                <div class="summary-item">
                  <span>Shipping:</span>
                  <span id="shippingDisplay">0.00</span>
                </div>
                <div class="summary-item summary-total">
                  <span>Total:</span>
                  <span id="totalDisplay">0.00</span>
                </div>
                <div class="coupon-code">
                  <input type="text" id="couponInput" placeholder="Enter Coupon Code">
                  <button class="btn btn-outline-primary apply-coupon mt-2" onclick="applyCoupon()">Apply Coupon</button>
                </div>
                <button class="btn btn-success checkout-btn mt-3" onclick="proceedToCheckout()">Proceed to Checkout</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    
    <!-- Footer Placeholder (loaded dynamically via loadHTML) -->
    <div id="footer-placeholder"></div>
    
    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script to load header and footer dynamically -->
    <script>
      function loadHTML(elementId, filePath) {
        fetch(filePath)
          .then(response => {
            if (!response.ok) {
              if (elementId === "header-placeholder") {
                document.getElementById(elementId).innerHTML = '<header style="background:#333;color:#fff;padding:10px;text-align:center;">Header</header>';
              } else if (elementId === "footer-placeholder") {
                document.getElementById(elementId).innerHTML = '<footer style="background:#333;color:#fff;padding:10px;text-align:center;">Footer</footer>';
              }
              throw new Error("Error fetching " + filePath);
            }
            return response.text();
          })
          .then(html => {
            document.getElementById(elementId).innerHTML = html;
          })
          .catch(error => console.error(error));
      }
      document.addEventListener("DOMContentLoaded", function() {
        loadHTML("header-placeholder", "header.html");
        loadHTML("footer-placeholder", "footer.html");
      });
    </script>
    
    <!-- Cart Functionality Script -->
    <script>
      // Dummy cart data – replace with real integration later
      let cartItems = [
        {
          id: 1,
          name: "Smartphone A",
          price: 894,
          quantity: 1,
          image: "https://via.placeholder.com/100?text=Smartphone+A"
        },
        {
          id: 2,
          name: "Smart TV B",
          price: 557,
          quantity: 2,
          image: "https://via.placeholder.com/100?text=Smart+TV+B"
        },
        {
          id: 3,
          name: "Laptop C",
          price: 1004,
          quantity: 1,
          image: "https://via.placeholder.com/100?text=Laptop+C"
        }
      ];
      
      // Render cart items into the table
      function renderCartItems() {
        const container = document.getElementById("cartItemsContainer");
        container.innerHTML = "";
        cartItems.forEach((item, index) => {
          const itemSubtotal = item.price * item.quantity;
          const row = document.createElement("tr");
          row.innerHTML = `
            <td><input type="checkbox" class="item-checkbox" onchange="updateDeleteIcon()"></td>
            <td><img src="${item.image}" alt="${item.name}"></td>
            <td class="prod-name">${item.name}</td>
            <td>${item.price}</td>
            <td>
              <div class="quantity-controls">
                <button class="btn btn-sm btn-outline-secondary qty-minus" onclick="changeQuantity(${index}, -1)">-</button>
                <input type="text" class="quantity-input" value="${item.quantity}" readonly ${item.quantity==0 ? 'class="quantity-zero"' : ""}>
                <button class="btn btn-sm btn-outline-secondary qty-plus" onclick="changeQuantity(${index}, 1)">+</button>
              </div>
            </td>
            <td id="itemSubtotal-${index}">${itemSubtotal.toFixed(2)}</td>
          `;
          container.appendChild(row);
        });
        updateSummary();
      }
      
      // Update quantity
      function changeQuantity(index, delta) {
        const item = cartItems[index];
        item.quantity = Math.max(0, item.quantity + delta);
        renderCartItems();
      }
      
      // Update global order summary
      function updateSummary() {
        let subtotal = cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
        let tax = subtotal * 0.10; // 10% tax
        let discount = subtotal * couponDiscount;
        let total = subtotal + tax + shippingCost - discount;
        document.getElementById("subtotalDisplay").innerText = subtotal.toFixed(2);
        document.getElementById("taxDisplay").innerText = tax.toFixed(2);
        document.getElementById("shippingDisplay").innerText = shippingCost.toFixed(2);
        document.getElementById("totalDisplay").innerText = total.toFixed(2);
      }
      
      // Global coupon variables
      let couponDiscount = 0;
      let shippingCost = 150;
      
      function applyCoupon() {
        const couponCode = document.getElementById("couponInput").value.trim().toUpperCase();
        if (couponCode === "SAVE10") {
          couponDiscount = 0.10;
          alert("Coupon applied: 10% discount!");
        } else if (couponCode === "SAVE20") {
          couponDiscount = 0.20;
          alert("Coupon applied: 20% discount!");
        } else {
          couponDiscount = 0;
          alert("Invalid coupon code.");
        }
        updateSummary();
      }
      
      function proceedToCheckout() {
        alert("Proceeding to checkout...");
      }
      
      // Global deletion functionality:
      // When at least one checkbox is selected, show the delete icon.
      function updateDeleteIcon() {
        const checkboxes = document.querySelectorAll(".item-checkbox");
        let anyChecked = Array.from(checkboxes).some(cb => cb.checked);
        const deleteIcon = document.getElementById("deleteIcon");
        if (anyChecked) {
          deleteIcon.style.display = "block";
        } else {
          deleteIcon.style.display = "none";
        }
      }
      
      // When the delete icon is clicked, confirm and then delete the checked items.
      document.getElementById("deleteIcon")?.addEventListener("click", function() {
        if (confirm("Are you sure you want to delete the selected items?")) {
          const checkboxes = document.querySelectorAll(".item-checkbox");
          // Iterate backwards to safely remove items from array
          for (let i = checkboxes.length - 1; i >= 0; i--) {
            if (checkboxes[i].checked) {
              cartItems.splice(i, 1);
            }
          }
          renderCartItems();
          // Hide the delete icon after deletion
          document.getElementById("deleteIcon").style.display = "none";
        }
      });
      
      document.addEventListener("DOMContentLoaded", function() {
        renderCartItems();
      });
    </script>
    
    <!--
      How to Use Later:
      1. The header and footer are loaded dynamically via loadHTML().
      2. The small hero and subheader provide a quick overview and extra options (chat, track order, help).
      3. The cart table is responsive and fixed to screen width – no horizontal scrolling.
      4. Quantity controls: The plus button (green) increases quantity; the minus button (red) decreases quantity.
         If quantity reaches 0, it is shown in red.
      5. The first table column has checkboxes. When any checkbox is selected, a global delete icon (recycle bin)
         appears in the top-right of the screen. Clicking this icon prompts a confirmation before deleting the selected items.
      6. Order summary is automatically updated based on the cart data, tax, shipping, and any coupon applied.
      
      Later, you can integrate these functions with your backend (for example, Firebase) to handle real data,
      authentication, and persistent cart management.
    -->
  </body>
</html>
