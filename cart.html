$('form.cart').on('click', 'button.plus, button.minus', function(e) {
  e.preventDefault();
  e.stopImmediatePropagation();
  // Capture the current scroll position
  var currentScroll = $(window).scrollTop();
  
  // Immediately remove focus
  $(this).blur();
  
  var qty = $(this).closest('form.cart').find('.qty');
  var val = parseFloat(qty.val());
  var max = parseFloat(qty.attr('max'));
  var min = parseFloat(qty.attr('min'));
  var step = parseFloat(qty.attr('step')) || 1;
  
  if ($(this).hasClass('plus')) {
    if (!isNaN(max) && max <= val) {
      qty.val(max).change();
    } else {
      qty.val(val + step).change();
    }
  } else {
    if (!isNaN(min) && min >= val) {
      qty.val(min).change();
    } else if (val > 1) {
      qty.val(val - step).change();
    }
  }
  
  // Restore scroll position to prevent page jump
  $(window).scrollTop(currentScroll);
});
