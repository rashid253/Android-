<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyBusiness Cart</title>
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css" />
    <style>
      /* Enhanced Cart Page Styles */
      .cart-container {
        padding: 20px;
        background: #f4f4f4;
        min-height: calc(100vh - 140px);
      }
      .cart-container h1 {
        margin-bottom: 20px;
        font-size: 2rem;
        color: #007bff;
        text-align: center;
      }
      .cart-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #fff;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .cart-item img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 4px;
        margin-right: 15px;
      }
      .cart-item-details {
        flex: 1;
      }
      .cart-item-details h3 {
        margin: 0 0 8px 0;
        color: #333;
      }
      .cart-item-details p {
        margin: 0 0 10px 0;
        color: #666;
      }
      .quantity-controls {
        display: flex;
        align-items: center;
        margin-top: 8px;
      }
      .qty-btn {
        background: #007bff;
        color: #fff;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        font-size: 1rem;
        border-radius: 4px;
        transition: background 0.3s;
      }
      .qty-btn:hover {
        background: #0069d9;
      }
      .qty-value {
        margin: 0 10px;
        font-size: 1rem;
        min-width: 20px;
        text-align: center;
      }
      .cart-item-actions {
        display: flex;
        align-items: center;
      }
      .cart-item-actions button.remove-item {
        background: none;
        border: none;
        color: #dc3545;
        font-size: 1.2rem;
        cursor: pointer;
        margin-left: 10px;
      }
      .cart-summary {
        background: #fff;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        margin: 20px auto;
        font-size: 1.1rem;
      }
      .cart-summary div {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .coupon-container {
        text-align: center;
        margin: 20px 0;
      }
      .coupon-container input {
        padding: 8px;
        font-size: 1rem;
        width: 200px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-right: 10px;
      }
      .coupon-container button {
        padding: 8px 15px;
        font-size: 1rem;
        border: none;
        background: #28a745;
        color: #fff;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s;
      }
      .coupon-container button:hover {
        background: #218838;
      }
      .cart-actions {
        text-align: center;
        margin-top: 20px;
      }
      .cart-actions button {
        padding: 12px 25px;
        font-size: 1rem;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: background 0.3s;
        margin: 0 10px;
      }
      .update-cart {
        background: #007bff;
        color: #fff;
      }
      .update-cart:hover {
        background: #0069d9;
      }
      .checkout-button {
        background: #28a745;
        color: #fff;
      }
      .checkout-button:hover {
        background: #218838;
      }
      .empty-cart {
        text-align: center;
        font-size: 1.2rem;
        color: #666;
        margin-top: 50px;
      }
    </style>
  </head>
  <body>
    <!-- External Header -->
    <div id="header-placeholder"></div>

    <!-- Main Cart Content -->
    <main class="cart-container">
      <h1>Your Shopping Cart</h1>
      <div id="cart-items">
        <!-- Cart items will be dynamically rendered here -->
      </div>

      <!-- Cart Summary Section -->
      <div class="cart-summary">
        <div>
          <span>Subtotal:</span>
          <span id="subtotal">$0.00</span>
        </div>
        <div>
          <span>Discount:</span>
          <span id="discount">$0.00</span>
        </div>
        <div>
          <span>Total:</span>
          <span id="total">$0.00</span>
        </div>
      </div>

      <!-- Coupon Code Section -->
      <div class="coupon-container">
        <input type="text" id="coupon-code" placeholder="Enter coupon code" />
        <button id="apply-coupon">Apply Coupon</button>
      </div>

      <!-- Action Buttons -->
      <div class="cart-actions">
        <button id="update-cart" class="update-cart">Update Cart</button>
        <button id="checkout-button" class="checkout-button">
          Proceed to Checkout
        </button>
      </div>
    </main>

    <!-- External Footer -->
    <div id="footer-placeholder"></div>

    <!-- JavaScript for Cart Functionality -->
    <script>
      /* 
        This frontend code is built using dummy data and is structured to be easily integrated with a Firebase backend in the future.
        The fetchCartItems() function simulates data fetching, to be replaced by Firebase Firestore API calls.
        Authentication and data persistence will be handled via Firebase, allowing for dynamic and secure data management.
      */

      // Load external HTML for header and footer
      const loadHTML = (elementId, filePath) => {
        fetch(filePath)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Error fetching " + filePath);
            }
            return response.text();
          })
          .then((html) => {
            document.getElementById(elementId).innerHTML = html;
          })
          .catch((error) => console.error(error));
      };

      // Dummy cart data; to be replaced with Firebase data integration in the future.
      let cartItems = [
        {
          id: 1,
          name: "Product 1",
          price: 29.99,
          quantity: 1,
          image: "https://via.placeholder.com/80",
        },
        {
          id: 2,
          name: "Product 2",
          price: 49.99,
          quantity: 2,
          image: "https://via.placeholder.com/80",
        },
        {
          id: 3,
          name: "Product 3",
          price: 19.99,
          quantity: 1,
          image: "https://via.placeholder.com/80",
        },
      ];
      let appliedCoupon = null;

      // Render cart items to the DOM with plus/minus buttons
      function renderCart() {
        const container = document.getElementById("cart-items");
        container.innerHTML = "";
        if (cartItems.length === 0) {
          container.innerHTML =
            '<p class="empty-cart">Your cart is empty.</p>';
        } else {
          cartItems.forEach((item) => {
            const itemEl = document.createElement("div");
            itemEl.className = "cart-item";
            itemEl.innerHTML = `
              <img src="${item.image}" alt="${item.name}" />
              <div class="cart-item-details">
                <h3>${item.name}</h3>
                <p>$${item.price.toFixed(2)}</p>
                <div class="quantity-controls">
                  <button class="qty-btn" onclick="decrementQuantity(${item.id})">
                    <i class="fas fa-minus"></i>
                  </button>
                  <span class="qty-value" id="qty-${item.id}">${item.quantity}</span>
                  <button class="qty-btn" onclick="incrementQuantity(${item.id})">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
              <div class="cart-item-actions">
                <button class="remove-item" onclick="removeItem(${item.id})" title="Remove">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            `;
            container.appendChild(itemEl);
          });
        }
        calculateTotals();
      }

      // Increase item quantity
      function incrementQuantity(id) {
        const item = cartItems.find(item => item.id === id);
        if (item) {
          item.quantity++;
          document.getElementById(`qty-${id}`).innerText = item.quantity;
          calculateTotals();
        }
      }

      // Decrease item quantity ensuring it does not go below 1
      function decrementQuantity(id) {
        const item = cartItems.find(item => item.id === id);
        if (item && item.quantity > 1) {
          item.quantity--;
          document.getElementById(`qty-${id}`).innerText = item.quantity;
          calculateTotals();
        }
      }

      // Remove an item from the cart with confirmation
      function removeItem(id) {
        if (confirm("Are you sure you want to remove this item?")) {
          cartItems = cartItems.filter((item) => item.id !== id);
          renderCart();
        }
      }

      // Calculate subtotal, discount, and total
      function calculateTotals() {
        let subtotal = 0;
        cartItems.forEach((item) => {
          subtotal += item.price * item.quantity;
        });
        let discount = 0;
        if (appliedCoupon === "SAVE10") {
          discount = subtotal * 0.1;
        }
        const total = subtotal - discount;
        document.getElementById("subtotal").innerText =
          "$" + subtotal.toFixed(2);
        document.getElementById("discount").innerText =
          "$" + discount.toFixed(2);
        document.getElementById("total").innerText = "$" + total.toFixed(2);
      }

      // Apply coupon code logic (dummy implementation)
      function applyCoupon() {
        const couponInput = document.getElementById("coupon-code");
        const coupon = couponInput.value.trim().toUpperCase();
        if (coupon === "SAVE10") {
          appliedCoupon = coupon;
          alert("Coupon applied: 10% off!");
        } else {
          appliedCoupon = null;
          alert("Invalid coupon code.");
        }
        calculateTotals();
      }

      // Simulate saving updated cart data
      function updateCart() {
        alert("Cart updated!");
        calculateTotals();
      }

      // Initialize the cart page on DOM load
      document.addEventListener("DOMContentLoaded", () => {
        loadHTML("header-placeholder", "header.html");
        loadHTML("footer-placeholder", "footer.html");
        renderCart();
        document
          .getElementById("apply-coupon")
          .addEventListener("click", applyCoupon);
        document
          .getElementById("update-cart")
          .addEventListener("click", updateCart);
        document
          .getElementById("checkout-button")
          .addEventListener("click", () => {
            alert("Proceeding to checkout...");
          });
      });
    </script>
  </body>
</html>
