<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyBusiness Cart</title>
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <style>
      /* Global resets */
      html, body {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        overflow-x: hidden;
        font-family: Arial, sans-serif;
      }
      
      /* Hero Section */
      .hero-cart {
        background: #007bff;
        color: #fff;
        padding: 30px 15px;
        text-align: center;
        margin-top: 60px;
        margin-bottom: 15px;
      }
      .hero-cart h1 {
        font-size: 2.2rem;
        margin: 0;
      }
      .hero-cart p {
        margin-top: 8px;
        font-size: 0.95rem;
        white-space: normal;
      }
      
      /* Cart Container */
      .cart-container {
        padding: 15px;
        padding-bottom: 100px;
        background: #f4f4f4;
        min-height: calc(100vh - 120px);
      }
      
      /* Cart Item */
      .cart-item {
        display: flex;
        align-items: center;
        padding: 10px;
        background: #fff;
        border-radius: 8px;
        margin-bottom: 10px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }
      .cart-item img {
        width: 70px;
        height: 70px;
        object-fit: cover;
        border-radius: 4px;
        margin-right: 10px;
      }
      .cart-item-details {
        flex: 1;
      }
      .cart-item-details h3 {
        font-size: 1.1rem;
        margin-bottom: 4px;
        color: #333;
      }
      .cart-item-details p {
        font-size: 0.95rem;
        color: #666;
      }
      
      /* Vertical Quantity Controls */
      .quantity-vertical {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-left: 8px;
      }
      .quantity-vertical button {
        background: #007bff;
        border: none;
        color: #fff;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s;
      }
      .quantity-vertical button:hover {
        background: #0069d9;
      }
      .quantity-vertical span {
        margin: 4px 0;
        font-size: 1rem;
        min-width: 20px;
        text-align: center;
      }
      
      /* Cart Total and Checkout Button */
      .cart-total {
        text-align: right;
        font-size: 1.2rem;
        font-weight: bold;
        margin-top: 10px;
      }
      .checkout-button {
        background: #28a745;
        border: none;
        color: #fff;
        padding: 10px 20px;
        font-size: 1rem;
        border-radius: 25px;
        cursor: pointer;
        margin-top: 10px;
        width: 100%;
        transition: background-color 0.3s;
      }
      .checkout-button:hover {
        background: #218838;
      }
      .empty-cart {
        text-align: center;
        font-size: 1rem;
        margin-top: 20px;
        color: #666;
      }
      
      /* Detailed Receipt Section */
      .receipt {
        margin-top: 20px;
        background: #fff;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }
      .receipt h2 {
        font-size: 1.3rem;
        color: #007bff;
        margin-bottom: 10px;
      }
      .receipt table {
        width: 100%;
        border-collapse: collapse;
      }
      .receipt th, .receipt td {
        padding: 6px;
        text-align: left;
        border-bottom: 1px solid #ddd;
        font-size: 0.9rem;
      }
      .receipt th {
        background: #f4f4f4;
      }
      
      /* Token Section */
      .token-section {
        margin-top: 40px;
        background: #fff;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }
      .token-section h2 {
        font-size: 1.3rem;
        color: #007bff;
        margin-bottom: 10px;
      }
      .token-section input {
        padding: 6px;
        font-size: 0.9rem;
        width: 120px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-right: 8px;
      }
      .token-section button {
        padding: 6px 12px;
        font-size: 0.9rem;
        border: none;
        background: #28a745;
        color: #fff;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s;
      }
      .token-section button:hover {
        background: #218838;
      }
      
      /* Media Query for larger screens */
      @media (min-width: 600px) {
        .cart-container {
          padding: 20px 40px;
        }
        .checkout-button {
          width: auto;
          float: right;
        }
      }
    </style>
  </head>
  <body>
    <!-- External Header -->
    <div id="header-placeholder"></div>
    
    <!-- Hero Section -->
    <section class="hero-cart">
      <div class="hero-content">
        <h1>Your Order Awaits</h1>
        <p>Review your order, adjust quantities, and apply tokens for extra Rs savings.</p>
      </div>
    </section>
    
    <!-- Cart Container -->
    <main class="cart-container">
      <div id="cart-items">
        <!-- Dynamic cart items will be rendered here -->
      </div>
      <div class="cart-total" id="cart-total">Total: Rs 0.00</div>
      <button class="checkout-button" id="checkout-button">Proceed to Checkout</button>
      
      <!-- Detailed Receipt Section -->
      <div class="receipt" id="detailed-receipt">
        <h2>Order Details</h2>
        <table>
          <thead>
            <tr>
              <th>Item</th>
              <th>Qty</th>
              <th>Unit Price</th>
              <th>Line Total</th>
            </tr>
          </thead>
          <tbody id="receipt-body">
            <!-- Receipt details will be rendered here -->
          </tbody>
        </table>
      </div>
      
      <!-- Token Section -->
      <div class="token-section">
        <h2>Apply Tokens</h2>
        <p>You have <span id="user-tokens">50</span> tokens available.</p>
        <input type="number" id="token-input" placeholder="Tokens to apply" min="0">
        <button id="apply-tokens">Apply Tokens</button>
        <p id="token-message"></p>
      </div>
    </main>
    
    <!-- External Footer -->
    <div id="footer-placeholder"></div>
    
    <script>
      // Dummy cart data
      let cartItems = [
        { id: 1, name: "Product 1", price: 29.99, quantity: 1, image: "https://via.placeholder.com/80" },
        { id: 2, name: "Product 2", price: 49.99, quantity: 2, image: "https://via.placeholder.com/80" },
        { id: 3, name: "Product 3", price: 19.99, quantity: 1, image: "https://via.placeholder.com/80" }
      ];
      
      let userTokens = 50;
      let appliedTokens = 0;
      
      let updateTimer;
      const DEBOUNCE_DELAY = 300;
      
      function renderCartItems() {
        const container = document.getElementById("cart-items");
        if (cartItems.length === 0) {
          container.innerHTML = '<p class="empty-cart">Your cart is empty.</p>';
          return;
        }
        container.innerHTML = "";
        cartItems.forEach(item => {
          const div = document.createElement("div");
          div.className = "cart-item";
          div.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <div class="cart-item-details">
              <h3>${item.name}</h3>
              <p>Price: Rs ${item.price.toFixed(2)} | Qty: <span id="quantity-${item.id}">${item.quantity}</span></p>
            </div>
            <div class="quantity-vertical">
              <button onclick="increaseQuantity(${item.id})" title="Increase Quantity">
                <i class="fas fa-plus"></i>
              </button>
              <span id="vertical-qty-${item.id}">${item.quantity}</span>
              <button onclick="decreaseQuantity(${item.id})" title="Decrease Quantity">
                <i class="fas fa-minus"></i>
              </button>
            </div>
          `;
          container.appendChild(div);
        });
      }
      
      function increaseQuantity(itemId) {
        const index = cartItems.findIndex(item => item.id === itemId);
        if (index > -1) {
          updateQuantity(itemId, cartItems[index].quantity + 1);
        }
      }
      
      function decreaseQuantity(itemId) {
        const index = cartItems.findIndex(item => item.id === itemId);
        if (index > -1 && cartItems[index].quantity > 1) {
          updateQuantity(itemId, cartItems[index].quantity - 1);
        }
      }
      
      function updateQuantity(itemId, newQty) {
        if (newQty < 1) return;
        const index = cartItems.findIndex(item => item.id === itemId);
        if (index > -1) {
          cartItems[index].quantity = newQty;
          document.getElementById("quantity-" + itemId).innerText = newQty;
          document.getElementById("vertical-qty-" + itemId).innerText = newQty;
          clearTimeout(updateTimer);
          updateTimer = setTimeout(updateTotals, DEBOUNCE_DELAY);
        }
      }
      
      function updateTotals() {
        const totalContainer = document.getElementById("cart-total");
        const receiptBody = document.getElementById("receipt-body");
        let total = 0;
        receiptBody.innerHTML = "";
        cartItems.forEach(item => {
          const lineTotal = item.price * item.quantity;
          total += lineTotal;
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${item.name}</td>
            <td>${item.quantity}</td>
            <td>Rs ${item.price.toFixed(2)}</td>
            <td>Rs ${lineTotal.toFixed(2)}</td>
          `;
          receiptBody.appendChild(row);
        });
        const tokenDiscount = appliedTokens * 0.10;
        const finalTotal = Math.max(total - tokenDiscount, 0);
        totalContainer.innerText = "Total: Rs " + finalTotal.toFixed(2);
      }
      
      function applyTokens() {
        const tokenInput = document.getElementById("token-input");
        const tokensToApply = parseInt(tokenInput.value);
        const tokenMessage = document.getElementById("token-message");
        if (isNaN(tokensToApply) || tokensToApply < 0) {
          tokenMessage.innerText = "Please enter a valid number of tokens.";
          return;
        }
        if (tokensToApply > userTokens) {
          tokenMessage.innerText = "You do not have enough tokens.";
          return;
        }
        appliedTokens = tokensToApply;
        tokenMessage.innerText = "Tokens applied: " + appliedTokens;
        updateTotals();
      }
      
      document.addEventListener("DOMContentLoaded", () => {
        renderCartItems();
        updateTotals();
        // Proceed to checkout: navigate to checkout.html
        document.getElementById("checkout-button").addEventListener("click", () => {
          window.location.href = "checkout.html";
        });
        document.getElementById("apply-tokens").addEventListener("click", applyTokens);
        
        // Load external header and footer if available
        function loadHTML(elementId, filePath) {
          fetch(filePath)
            .then(response => {
              if (!response.ok) throw new Error("Error fetching " + filePath);
              return response.text();
            })
            .then(html => {
              document.getElementById(elementId).innerHTML = html;
            })
            .catch(error => console.error(error));
        }
        loadHTML("header-placeholder", "header.html");
        loadHTML("footer-placeholder", "footer.html");
      });
    </script>
  </body>
</html>
