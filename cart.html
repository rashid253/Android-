<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyBusiness Cart</title>
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css" />
    <style>
      /* Hero Section for the Cart Title */
      .hero-cart {
        background: #007bff;
        color: #fff;
        padding: 60px 20px;
        text-align: center;
        margin-bottom: 20px;
      }
      .hero-cart h1 {
        font-size: 2.5rem;
        margin: 0;
      }
      
      /* Overall Cart Container */
      .cart-container {
        padding: 20px;
        background: #f4f4f4;
        min-height: calc(100vh - 140px);
      }
      
      /* Trash Bin Container for deletion (blue trash bin with red count badge) */
      #trash-bin-container {
        position: relative;
        display: inline-block;
        cursor: pointer;
        margin-bottom: 15px;
      }
      #trash-bin-container i {
        font-size: 2rem;
        color: blue;
      }
      #trash-count {
        position: absolute;
        bottom: -5px;
        right: -5px;
        background: red;
        color: #fff;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 0.8rem;
      }
      
      /* Cart Item Styles */
      .cart-item {
        display: flex;
        align-items: center;
        padding: 15px;
        background: #fff;
        border-radius: 8px;
        margin-bottom: 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .cart-item input[type="checkbox"] {
        margin-right: 10px;
      }
      .cart-item img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 4px;
        margin-right: 15px;
        display: block;
      }
      .cart-item-details {
        flex: 1;
      }
      .cart-item-details h3 {
        font-size: 1.2rem;
        margin-bottom: 8px;
        color: #333;
      }
      .cart-item-details p {
        margin: 4px 0 10px 0;
        color: #666;
      }
      
      /* Vertical Quantity Controls on the Right */
      .quantity-vertical {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-left: 15px;
      }
      .quantity-vertical button {
        background: #007bff;
        border: none;
        color: #fff;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s;
      }
      .quantity-vertical button:hover {
        background: #0069d9;
      }
      .quantity-vertical span {
        margin: 8px 0;
        font-size: 1rem;
        min-width: 20px;
        text-align: center;
      }
      
      /* Cart Total and Checkout */
      .cart-total {
        text-align: right;
        font-size: 1.3rem;
        font-weight: bold;
        margin-top: 20px;
      }
      .checkout-button {
        background: #28a745;
        border: none;
        color: #fff;
        padding: 12px 25px;
        font-size: 1rem;
        border-radius: 25px;
        cursor: pointer;
        margin-top: 20px;
        float: right;
        transition: background-color 0.3s;
      }
      .checkout-button:hover {
        background: #218838;
      }
      .empty-cart {
        text-align: center;
        font-size: 1.2rem;
        margin-top: 50px;
        color: #666;
      }
      
      /* Detailed Receipt Section */
      .receipt {
        margin-top: 30px;
        background: #fff;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .receipt h2 {
        font-size: 1.5rem;
        color: #007bff;
        margin-bottom: 15px;
      }
      .receipt table {
        width: 100%;
        border-collapse: collapse;
      }
      .receipt th,
      .receipt td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      .receipt th {
        background: #f4f4f4;
      }
      
      /* Token System Section */
      .token-section {
        margin-top: 30px;
        background: #fff;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .token-section h2 {
        font-size: 1.5rem;
        color: #007bff;
        margin-bottom: 15px;
      }
      .token-section input {
        padding: 8px;
        font-size: 1rem;
        width: 150px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-right: 10px;
      }
      .token-section button {
        padding: 8px 15px;
        font-size: 1rem;
        border: none;
        background: #28a745;
        color: #fff;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s;
      }
      .token-section button:hover {
        background: #218838;
      }
    </style>
  </head>
  <body>
    <!-- External Header -->
    <div id="header-placeholder"></div>
    
    <!-- Hero Section for Cart Title -->
    <section class="hero-cart">
      <div class="hero-content">
        <h1>Your Shopping Cart</h1>
      </div>
    </section>
    
    <!-- Main Cart Content -->
    <main class="cart-container">
      <!-- Trash Bin Icon for Deletion -->
      <div id="trash-bin-container" title="Delete selected items">
        <i class="fas fa-trash-alt"></i>
        <div id="trash-count">0</div>
      </div>
      
      <div id="cart-items">
        <!-- Dynamic cart items will be rendered here -->
      </div>
      <div class="cart-total" id="cart-total">Total: $0.00</div>
      <button class="checkout-button" id="checkout-button">
        Proceed to Checkout
      </button>
      
      <!-- Detailed Receipt Section -->
      <div class="receipt" id="detailed-receipt">
        <h2>Order Details</h2>
        <table>
          <thead>
            <tr>
              <th>Item</th>
              <th>Qty</th>
              <th>Unit Price</th>
              <th>Line Total</th>
            </tr>
          </thead>
          <tbody id="receipt-body">
            <!-- Receipt details will be rendered here -->
          </tbody>
        </table>
      </div>
      
      <!-- Token System Section -->
      <div class="token-section">
        <h2>Apply Tokens</h2>
        <p>You have <span id="user-tokens">50</span> tokens available.</p>
        <input type="number" id="token-input" placeholder="Tokens to apply" min="0" />
        <button id="apply-tokens">Apply Tokens</button>
        <p id="token-message"></p>
      </div>
    </main>
    
    <!-- External Footer -->
    <div id="footer-placeholder"></div>
    
    <!-- JavaScript for cart functionality -->
    <script>
      /* 
         This frontend code uses dummy data and is structured for future integration with Firebase.
         Global state (cartItems, tokens, etc.) is maintained locally.
      */
      
      // Global cart items (dummy data)
      let cartItems = [
        { id: 1, name: "Product 1", price: 29.99, quantity: 1, image: "https://via.placeholder.com/80" },
        { id: 2, name: "Product 2", price: 49.99, quantity: 2, image: "https://via.placeholder.com/80" },
        { id: 3, name: "Product 3", price: 19.99, quantity: 1, image: "https://via.placeholder.com/80" }
      ];
      
      // Token system: dummy tokens
      let userTokens = 50;
      let appliedTokens = 0;
      
      // Debounce timer for quantity updates
      let updateTimer;
      const DEBOUNCE_DELAY = 300; // milliseconds
      
      // Render the cart items list (initial rendering)
      const renderCartItems = () => {
        const cartItemsContainer = document.getElementById("cart-items");
        if (cartItems.length === 0) {
          cartItemsContainer.innerHTML = '<p class="empty-cart">Your cart is empty.</p>';
          return;
        }
        cartItemsContainer.innerHTML = "";
        cartItems.forEach(item => {
          // Each cart item with a checkbox for selection, image, details, and vertical quantity controls.
          const itemEl = document.createElement("div");
          itemEl.className = "cart-item";
          itemEl.innerHTML = `
            <input type="checkbox" class="delete-checkbox" data-id="${item.id}" />
            <img src="${item.image}" alt="${item.name}" />
            <div class="cart-item-details">
              <h3>${item.name}</h3>
              <p>
                $${item.price.toFixed(2)} x 
                <span id="quantity-${item.id}">${item.quantity}</span> = 
                $<span id="lineTotal-${item.id}">${(item.price * item.quantity).toFixed(2)}</span>
              </p>
            </div>
            <div class="quantity-vertical">
              <button onclick="increaseQuantity(${item.id})" title="Increase Quantity">
                <i class="fas fa-plus"></i>
              </button>
              <span id="vertical-qty-${item.id}">${item.quantity}</span>
              <button onclick="decreaseQuantity(${item.id})" title="Decrease Quantity">
                <i class="fas fa-minus"></i>
              </button>
            </div>
          `;
          cartItemsContainer.appendChild(itemEl);
        });
      };
      
      // Increase and decrease functions use the current state to adjust quantity.
      function increaseQuantity(itemId) {
        const index = cartItems.findIndex(item => item.id === itemId);
        if (index > -1) {
          updateQuantity(itemId, cartItems[index].quantity + 1);
        }
      }
      function decreaseQuantity(itemId) {
        const index = cartItems.findIndex(item => item.id === itemId);
        if (index > -1 && cartItems[index].quantity > 1) {
          updateQuantity(itemId, cartItems[index].quantity - 1);
        }
      }
      
      // Update only the quantity and line total for a specific item.
      function updateQuantity(itemId, newQuantity) {
        if (newQuantity < 1) return;
        const index = cartItems.findIndex(item => item.id === itemId);
        if (index > -1) {
          cartItems[index].quantity = newQuantity;
          document.getElementById("quantity-" + itemId).innerText = newQuantity;
          document.getElementById("vertical-qty-" + itemId).innerText = newQuantity;
          document.getElementById("lineTotal-" + itemId).innerText = (cartItems[index].price * newQuantity).toFixed(2);
          clearTimeout(updateTimer);
          updateTimer = setTimeout(updateTotals, DEBOUNCE_DELAY);
        }
      }
      
      // Update global total and detailed receipt.
      function updateTotals() {
        const cartTotalContainer = document.getElementById("cart-total");
        const receiptBody = document.getElementById("receipt-body");
        let total = 0;
        receiptBody.innerHTML = "";
        cartItems.forEach(item => {
          const lineTotal = item.price * item.quantity;
          total += lineTotal;
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${item.name}</td>
            <td>${item.quantity}</td>
            <td>$${item.price.toFixed(2)}</td>
            <td>$${lineTotal.toFixed(2)}</td>
          `;
          receiptBody.appendChild(row);
        });
        const tokenDiscount = appliedTokens * 0.10;
        const finalTotal = Math.max(total - tokenDiscount, 0);
        cartTotalContainer.innerText = "Total: $" + finalTotal.toFixed(2);
      }
      
      // Update trash bin count (number of selected items).
      function updateTrashCount() {
        const checkedBoxes = document.querySelectorAll(".delete-checkbox:checked");
        document.getElementById("trash-count").innerText = checkedBoxes.length;
      }
      
      // Delete selected items when trash bin is clicked.
      function deleteSelectedItems() {
        const checkedBoxes = document.querySelectorAll(".delete-checkbox:checked");
        if (checkedBoxes.length === 0) return;
        if (!confirm("Are you sure you want to delete the selected items?")) return;
        const idsToDelete = Array.from(checkedBoxes).map(cb => parseInt(cb.getAttribute("data-id")));
        cartItems = cartItems.filter(item => !idsToDelete.includes(item.id));
        renderCartItems();
        updateTotals();
        updateTrashCount();
      }
      
      // Load external HTML for header and footer.
      const loadHTML = (elementId, filePath) => {
        fetch(filePath)
          .then(response => {
            if (!response.ok) throw new Error("Error fetching " + filePath);
            return response.text();
          })
          .then(html => { document.getElementById(elementId).innerHTML = html; })
          .catch(error => console.error(error));
      };
      
      // Apply tokens to the order.
      function applyTokens() {
        const tokenInput = document.getElementById("token-input");
        const tokensToApply = parseInt(tokenInput.value);
        const tokenMessage = document.getElementById("token-message");
        if (isNaN(tokensToApply) || tokensToApply < 0) {
          tokenMessage.innerText = "Please enter a valid number of tokens.";
          return;
        }
        if (tokensToApply > userTokens) {
          tokenMessage.innerText = "You do not have enough tokens.";
          return;
        }
        appliedTokens = tokensToApply;
        tokenMessage.innerText = "Tokens applied: " + appliedTokens;
        updateTotals();
      }
      
      // Activate header hamburger icon if present.
      function activateHeaderMenu() {
        const menuToggle = document.querySelector(".menu-toggle");
        if (menuToggle) {
          menuToggle.addEventListener("click", () => {
            const sideMenu = document.getElementById("side-menu");
            if (sideMenu) sideMenu.classList.toggle("visible");
          });
        }
      }
      
      // Initialization on DOM load.
      document.addEventListener("DOMContentLoaded", () => {
        renderCartItems();
        updateTotals();
        loadHTML("header-placeholder", "header.html");
        loadHTML("footer-placeholder", "footer.html");
        document.addEventListener("change", event => {
          if (event.target.classList.contains("delete-checkbox")) {
            updateTrashCount();
          }
        });
        document.getElementById("trash-bin-container").addEventListener("click", deleteSelectedItems);
        document.getElementById("apply-tokens").addEventListener("click", applyTokens);
        document.getElementById("checkout-button").addEventListener("click", () => {
          alert("Proceeding to checkout...");
        });
        document.getElementById("user-tokens").innerText = userTokens;
        activateHeaderMenu();
      });
    </script>
  </body>
</html>
