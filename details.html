<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Details - NextGen E-commerce</title>
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Bootstrap 5 CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <!-- Global Styles -->
    <link rel="stylesheet" href="style.css" />
    <!-- Custom JavaScript -->
    <script src="script.js" defer></script>
    <style>
      /* Additional overrides for details.html */
      body {
        margin-top: 70px;
        scroll-behavior: smooth;
      }
      .section-nav {
        background: #fff;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        position: sticky;
        top: 0;
        z-index: 999;
      }
      .section-nav .nav-link {
        color: #007bff;
        font-weight: bold;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px 0;
      }
      .section-nav .nav-link i {
        font-size: 1.5rem;
        margin-bottom: 5px;
      }
      .section-nav .nav-link:hover {
        color: #0056b3;
      }
      .description-content {
        max-height: 150px;
        overflow: hidden;
        transition: max-height 0.4s ease;
      }
      .description-content.expanded {
        max-height: 1000px;
      }
      .review-full {
        display: none;
      }
      .review-full.expanded {
        display: block;
      }
      .star-icon {
        cursor: pointer;
        color: #ccc;
      }
      .star-icon.selected {
        color: #f5c518;
      }
    </style>
  </head>
  <body>
    <!-- External Header will be loaded here -->
    <div id="header-placeholder"></div>

    <!-- Product Details Section -->
    <div class="container mt-5 mb-5">
      <div class="row">
        <!-- Product Image -->
        <div class="col-md-5 text-center mb-3">
          <img
            id="productImage"
            src="https://via.placeholder.com/400x300?text=Product+Image"
            alt="Product Image"
            class="img-fluid rounded"
          />
        </div>
        <!-- Product Info -->
        <div class="col-md-7">
          <h2 id="productName">Product Name</h2>
          <p class="h5 text-primary" id="productPrice">PKR 0</p>
          <div id="productRating" class="star-rating mb-2"></div>
          <p id="productStats" class="text-muted mb-3">0 Added | 0 Sold</p>
          <button class="btn btn-success add-to-cart-btn mt-3">
            <i class="fa fa-shopping-cart"></i> Add to Cart
          </button>
        </div>
      </div>
    </div>

    <!-- Section Navigation Bar -->
    <nav class="section-nav">
      <div class="container d-flex justify-content-around">
        <a class="nav-link" href="#section-description">
          <i class="fa fa-file-text"></i>
          <span>Description</span>
        </a>
        <a class="nav-link" href="#section-reviews">
          <i class="fa fa-comments"></i>
          <span>Reviews</span>
        </a>
        <a class="nav-link" href="#section-related">
          <i class="fa fa-th"></i>
          <span>Related Items</span>
        </a>
      </div>
    </nav>

    <!-- Description Section -->
    <section id="section-description" class="container mt-4 mb-5">
      <h3>Description</h3>
      <div class="description-content" id="descriptionContent">
        <p id="productDescription">
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec vel
          mauris quam. Praesent sed nisi eleifend, varius nulla eu, auctor urna.
          Vestibulum ante ipsum primis in faucibus orci luctus et ultrices
          posuere cubilia curae; Suspendisse potenti. Proin ut tincidunt mauris,
          vel dapibus nulla. Nulla facilisi. Sed nec nulla vitae eros aliquet
          fermentum.
        </p>
      </div>
      <button class="btn btn-sm btn-outline-primary mt-2" id="descReadMore">
        Read More
      </button>
    </section>

    <!-- Reviews Section -->
    <section id="section-reviews" class="container mb-5">
      <h3>Reviews</h3>
      <div id="reviewsContainer">
        <div class="card mb-3">
          <div class="card-body">
            <p>
              <strong>User1:</strong> Amazing quality, highly recommended!
              <span
                class="review-read-more text-primary"
                style="cursor: pointer"
                >...Read more</span
              >
            </p>
            <p class="text-muted"><small>Reviewed on July 10, 2025</small></p>
            <p class="review-full" style="margin-bottom: 0">
              Full review text for User1. Lorem ipsum dolor sit amet, consectetur
              adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore
              magna aliqua.
            </p>
          </div>
        </div>
        <div class="card mb-3">
          <div class="card-body">
            <p>
              <strong>User2:</strong> Good value for money.
              <span
                class="review-read-more text-primary"
                style="cursor: pointer"
                >...Read more</span
              >
            </p>
            <p class="text-muted"><small>Reviewed on July 8, 2025</small></p>
            <p class="review-full" style="margin-bottom: 0">
              Full review text for User2. Additional details about the product
              experience go here.
            </p>
          </div>
        </div>
      </div>

      <!-- Write a Review -->
      <div class="card">
        <div class="card-body">
          <h5>Write a Review</h5>
          <div id="ratingStars" class="mb-2">
            <i class="fa fa-star star-icon" data-value="1"></i>
            <i class="fa fa-star star-icon" data-value="2"></i>
            <i class="fa fa-star star-icon" data-value="3"></i>
            <i class="fa fa-star star-icon" data-value="4"></i>
            <i class="fa fa-star star-icon" data-value="5"></i>
          </div>
          <textarea
            class="form-control mb-2"
            rows="3"
            placeholder="Share your experience after purchasing"
          ></textarea>
          <button class="btn btn-success">Submit Review</button>
        </div>
      </div>
    </section>

    <!-- Related Items Section -->
    <section id="section-related" class="container mb-5">
      <h3>Related Items</h3>
      <div class="row" id="relatedItemsContainer">
        <div class="col-6 col-md-3 mb-3">
          <div class="card text-center">
            <img
              src="https://via.placeholder.com/140x100?text=Item+1"
              alt="Item 1"
              class="card-img-top"
            />
            <div class="card-body p-2">
              <p class="small mb-0">Item 1</p>
            </div>
          </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
          <div class="card text-center">
            <img
              src="https://via.placeholder.com/140x100?text=Item+2"
              alt="Item 2"
              class="card-img-top"
            />
            <div class="card-body p-2">
              <p class="small mb-0">Item 2</p>
            </div>
          </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
          <div class="card text-center">
            <img
              src="https://via.placeholder.com/140x100?text=Item+3"
              alt="Item 3"
              class="card-img-top"
            />
            <div class="card-body p-2">
              <p class="small mb-0">Item 3</p>
            </div>
          </div>
        </div>
        <div class="col-6 col-md-3 mb-3">
          <div class="card text-center">
            <img
              src="https://via.placeholder.com/140x100?text=Item+4"
              alt="Item 4"
              class="card-img-top"
            />
            <div class="card-body p-2">
              <p class="small mb-0">Item 4</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- External Footer will be loaded here -->
    <div id="footer-placeholder"></div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // 1) Get the product from localStorage or use a default sample
      const storedProduct = JSON.parse(localStorage.getItem("selectedProduct"));
      const defaultProduct = {
        name: "Sample Product",
        price: 29.99,
        description: "This is a sample product for demonstration purposes.",
        image: "https://via.placeholder.com/400x300?text=Product+Image",
        rating: 4,
        added: 10,
        sold: 5,
        quantity: 1
      };
      const product = storedProduct || defaultProduct;

      // 2) Convert the price to a number (remove currency text, etc.)
      product.price = parseFloat(
        product.price.toString().replace(/[^\d.-]/g, "")
      ) || defaultProduct.price;

      // 3) If there's no stable ID, create one from the name
      if (!product.id) {
        product.id = product.name.replace(/\s+/g, "-").toLowerCase();
      }

      // 4) Populate details
      document.getElementById("productName").innerText = product.name;
      document.getElementById("productPrice").innerText = "PKR " + product.price;
      document.getElementById("productDescription").innerText = product.description;
      document.getElementById("productImage").src = product.image;
      document.getElementById("productRating").innerHTML = generateStars(product.rating);
      document.getElementById("productStats").innerText =
        product.added + " Added | " + product.sold + " Sold";

      function generateStars(rating) {
        let html = "";
        const fullStars = Math.floor(rating);
        const halfStar = rating - fullStars >= 0.5 ? 1 : 0;
        for (let i = 0; i < fullStars; i++) {
          html += '<i class="fa fa-star text-warning"></i>';
        }
        if (halfStar) {
          html += '<i class="fa fa-star-half-alt text-warning"></i>';
        }
        return html;
      }

      // Description "Read More" button
      const descReadMoreBtn = document.getElementById("descReadMore");
      const descContent = document.getElementById("descriptionContent");
      descReadMoreBtn.addEventListener("click", function () {
        descContent.classList.toggle("expanded");
        this.textContent = descContent.classList.contains("expanded")
          ? "Show Less"
          : "Read More";
      });

      // Reviews "Read More" toggles
      document.addEventListener("click", function (e) {
        if (e.target && e.target.classList.contains("review-read-more")) {
          const fullReview = e.target
            .closest(".card-body")
            .querySelector(".review-full");
          if (fullReview) {
            fullReview.classList.toggle("expanded");
            e.target.textContent = fullReview.classList.contains("expanded")
              ? " Show less"
              : "...Read more";
          }
        }
      });

      // Star rating selection for new review
      const starIcons = document.querySelectorAll("#ratingStars .star-icon");
      starIcons.forEach((star) => {
        star.addEventListener("click", function () {
          const rating = this.getAttribute("data-value");
          starIcons.forEach((s) => {
            s.getAttribute("data-value") <= rating
              ? s.classList.add("selected")
              : s.classList.remove("selected");
          });
        });
      });

      // 5) Add to Cart: merges with existing item if same ID is found
      document.querySelector(".add-to-cart-btn").addEventListener("click", function () {
        let cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
        // Make a copy of product to add
        let productToAdd = { ...product };

        // Convert price to numeric again, just to be safe
        productToAdd.price = parseFloat(
          productToAdd.price.toString().replace(/[^\d.-]/g, "")
        ) || productToAdd.price;

        // Check if product with same ID is already in the cart
        const existingIndex = cartItems.findIndex(
          (item) => item.id === productToAdd.id
        );
        if (existingIndex > -1) {
          // If exists, just increment quantity
          cartItems[existingIndex].quantity += 1;
        } else {
          // Otherwise, add as new item with quantity 1
          productToAdd.quantity = 1;
          cartItems.push(productToAdd);
        }

        // Save the cart
        localStorage.setItem("cartItems", JSON.stringify(cartItems));
        alert("Product added to cart!");
      });
    </script>
  </body>
</html>
