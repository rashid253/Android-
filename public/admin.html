<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Panel - Manage Page Content</title>
  <!-- Firebase libraries (compat versions for easier integration) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f2f2f2;
    }
    header {
      background: #007bff;
      color: #fff;
      padding: 15px;
      text-align: center;
    }
    .container {
      display: flex;
      height: calc(100vh - 60px);
    }
    .sidebar {
      width: 220px;
      background: #333;
      color: #fff;
      padding: 10px;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
    }
    .sidebar ul li {
      padding: 10px;
      cursor: pointer;
      border-radius: 4px;
      margin-bottom: 5px;
    }
    .sidebar ul li.active {
      background: #007bff;
    }
    .content {
      flex: 1;
      padding: 20px;
      background: #fff;
    }
    .content h2 {
      margin-top: 0;
    }
    textarea {
      width: 100%;
      height: 400px;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      box-sizing: border-box;
      resize: vertical;
    }
    button {
      padding: 10px 15px;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    .message {
      margin-top: 10px;
      padding: 10px;
      display: none;
      border-radius: 4px;
    }
    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
  </style>
</head>
<body>
  <header>
    <h1>Admin Panel - Manage Page Content</h1>
  </header>
  <div class="container">
    <div class="sidebar">
      <ul id="pageList">
        <!-- List only the pages you want to manage (exclude header and footer) -->
        <li data-page="index" class="active">Index</li>
        <li data-page="details">Details</li>
        <li data-page="offers">Offers</li>
        <li data-page="payments">Payments</li>
        <li data-page="support">Support</li>
        <li data-page="contact">Contact</li>
        <li data-page="delivery">Delivery</li>
        <li data-page="ecommerce">Ecommerce</li>
      </ul>
    </div>
    <div class="content">
      <h2 id="currentPageTitle">Index Page Content</h2>
      <!-- This text area shows the JSON content for the selected page -->
      <textarea id="contentEditor"></textarea>
      <br>
      <button id="saveButton">Save Changes</button>
      <div id="message" class="message"></div>
      <p style="margin-top: 20px; font-size: 13px; color: #555;">
        <strong>Instructions:</strong> Edit the JSON in the text area to update the content for the selected page.
        The changes you save here will update the Firestore document (in the collection "pages", with document ID equal to the page name).
        Make sure the JSON is valid.
      </p>
    </div>
  </div>

  <script>
    // Replace these placeholder values with your actual Firebase project configuration:
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const pageList = document.getElementById('pageList');
    const contentEditor = document.getElementById('contentEditor');
    const currentPageTitle = document.getElementById('currentPageTitle');
    const messageDiv = document.getElementById('message');
    const saveButton = document.getElementById('saveButton');

    let currentPage = "index"; // Default page

    // Function to load page content from Firestore
    function loadPageContent(page) {
      currentPage = page;
      currentPageTitle.innerText = page.charAt(0).toUpperCase() + page.slice(1) + " Page Content";
      db.collection('pages').doc(page).get().then(doc => {
        if (doc.exists) {
          // Pretty-print JSON data with 2-space indentation
          contentEditor.value = JSON.stringify(doc.data(), null, 2);
        } else {
          contentEditor.value = "{}"; // Empty object if no content exists
        }
      }).catch(error => {
        showMessage("Error loading content: " + error.message, true);
      });
    }

    // Function to show a temporary message
    function showMessage(msg, isError) {
      messageDiv.innerText = msg;
      messageDiv.className = "message " + (isError ? "error" : "success");
      messageDiv.style.display = "block";
      setTimeout(() => {
        messageDiv.style.display = "none";
      }, 3000);
    }

    // Set up sidebar navigation
    Array.from(pageList.getElementsByTagName('li')).forEach(li => {
      li.addEventListener('click', function() {
        Array.from(pageList.getElementsByTagName('li')).forEach(item => item.classList.remove('active'));
        this.classList.add('active');
        const page = this.getAttribute('data-page');
        loadPageContent(page);
      });
    });

    // Save changes when the button is clicked
    saveButton.addEventListener('click', function() {
      let newContent;
      try {
        newContent = JSON.parse(contentEditor.value);
      } catch (e) {
        showMessage("Invalid JSON: " + e.message, true);
        return;
      }
      // Save the JSON data into Firestore (collection "pages", document ID = currentPage)
      db.collection('pages').doc(currentPage).set(newContent, { merge: true })
        .then(() => {
          showMessage("Content updated successfully!");
        })
        .catch(error => {
          showMessage("Error saving content: " + error.message, true);
        });
    });

    // Initial load of the default page ("index")
    loadPageContent("index");
  </script>
</body>
</html>
