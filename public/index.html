<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Classwise Attendance Management</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Authentication Section -->
  <section id="auth-container" class="auth-container">
    <form id="auth-form" novalidate aria-labelledby="auth-heading">
      <h2 id="auth-heading">Please Login or Sign Up</h2>

      <div class="form-group">
        <label for="email">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          placeholder="you@example.com"
          required
          autocomplete="email"
        />
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input
          type="password"
          id="password"
          name="password"
          placeholder="••••••••"
          required
          minlength="6"
          autocomplete="current-password"
        />
      </div>

      <div id="auth-actions" class="row-inline">
        <button type="button" id="loginBtn">Login</button>
        <button type="button" id="signupBtn">Sign Up</button>
        <button type="button" id="resetPasswordBtn" class="small">
          Forgot Password?
        </button>
      </div>
    </form>
    <button type="button" id="logoutBtn" class="hidden">Logout</button>
  </section>

  <!-- Main Application Content -->
  <div id="app-content" class="hidden" aria-live="polite">
    <header>
      <h1>Attendance Management</h1>
      <button type="button" id="logoutPageBtn" class="small">Logout</button>
    </header>
    <!-- باقی کا System Content یہاں ویسا ہی رہے گا جیسا پہلے تھا -->
  </div>

  <!-- Firebase & Auth Logic -->
  <script type="module" defer>
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      sendEmailVerification,
      sendPasswordResetEmail,
      signOut
    } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA4QhGNwxn7lmvIzU6mpFL2Mz4B8134h6A",
      authDomain: "e-commerce-acad9.firebaseapp.com",
      projectId: "e-commerce-acad9",
      storageBucket: "e-commerce-acad9.appspot.com",
      messagingSenderId: "228138409600",
      appId: "1:228138409600:web:0a122885f7dbe08eb95065",
      measurementId: "G-NV1MG7R55W"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Elements
    const emailInput = document.getElementById("email");
    const pwdInput = document.getElementById("password");
    const loginBtn = document.getElementById("loginBtn");
    const signupBtn = document.getElementById("signupBtn");
    const resetBtn = document.getElementById("resetPasswordBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const logoutPageBtn = document.getElementById("logoutPageBtn");
    const authForm = document.getElementById("auth-form");
    const appContent = document.getElementById("app-content");

    // Auth State Listener
    onAuthStateChanged(auth, user => {
      if (user && user.emailVerified) {
        authForm.classList.add("hidden");
        logoutBtn.classList.remove("hidden");
        appContent.classList.remove("hidden");
      } else {
        appContent.classList.add("hidden");
        logoutBtn.classList.add("hidden");
        authForm.classList.remove("hidden");
      }
    });

    // Login
    loginBtn.addEventListener("click", () => {
      const email = emailInput.value;
      const pwd = pwdInput.value;
      signInWithEmailAndPassword(auth, email, pwd)
        .then(({ user }) => {
          if (!user.emailVerified) {
            alert("Please verify your email before logging in.");
            signOut(auth);
          }
        })
        .catch(err => alert(err.message));
    });

    // Sign Up with Email Confirmation
    signupBtn.addEventListener("click", () => {
      const email = emailInput.value;
      const pwd = pwdInput.value;
      createUserWithEmailAndPassword(auth, email, pwd)
        .then(({ user }) => sendEmailVerification(user))
        .then(() =>
          alert("Verification email sent. Please check your inbox.")
        )
        .catch(err => alert(err.message));
    });

    // Password Reset
    resetBtn.addEventListener("click", () => {
      const email = emailInput.value;
      sendPasswordResetEmail(auth, email)
        .then(() => alert("Password reset email sent."))
        .catch(err => alert(err.message));
    });

    // Logout (both buttons)
    const doSignOut = () => signOut(auth).catch(err => console.error(err));
    logoutBtn.addEventListener("click", doSignOut);
    logoutPageBtn.addEventListener("click", doSignOut);
  </script>

  <!-- Your existing app.js remains unchanged -->
  <script src="app.js" defer></script>
</body>
</html>
